@{
    ViewData["Title"] = "Ra quyết định cuối cùng";
    var submissionId = ViewData["SubmissionId"] ?? 0;
}

<div class="container-fluid my-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header -->
            <div class="mb-4">
                <h2 class="text-gradient mb-2">
                    <i class="fas fa-gavel me-2"></i>Ra quyết định cuối cùng
                </h2>
                <p class="text-muted">Xem tất cả phản biện và ra quyết định cuối cùng</p>
            </div>

            <!-- Submission Info -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Thông tin bài báo</h5>
                </div>
                <div class="card-body">
                    <h5 class="mb-3">Nghiên cứu về ứng dụng AI trong quản lý tài chính</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <span class="badge bg-info">Tài chính & Kế toán</span>
                        </div>
                        <div class="col-md-6 text-end">
                            <small class="text-muted">Mã bài: #@submissionId</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reviews Summary -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-clipboard-check me-2"></i>Tổng hợp phản biện</h5>
                </div>
                <div class="card-body">
                    <!-- Average Score -->
                    <div class="text-center mb-4 p-4 bg-light rounded">
                        <h6 class="text-muted mb-2">Điểm trung bình</h6>
                        <h2 class="text-primary mb-0">4.5 / 5.0</h2>
                        <small class="text-muted">Từ 2 phản biện</small>
                    </div>

                    <!-- Review 1 -->
                    <div class="mb-4 pb-4 border-bottom">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="mb-1">Phản biện 1</h6>
                                <small class="text-muted">GS. Nguyễn Văn X</small>
                            </div>
                            <span class="badge bg-success">Chấp nhận</span>
                        </div>
                        <div class="mb-2">
                            <small class="text-muted">Điểm: </small>
                            <span class="badge bg-primary">4.3/5</span>
                        </div>
                        <div class="bg-light p-3 rounded">
                            <p class="mb-0 small">Bài báo có chất lượng tốt, phương pháp nghiên cứu rõ ràng...</p>
                        </div>
                    </div>

                    <!-- Review 2 -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="mb-1">Phản biện 2</h6>
                                <small class="text-muted">PGS. Trần Thị Y</small>
                            </div>
                            <span class="badge bg-success">Chấp nhận</span>
                        </div>
                        <div class="mb-2">
                            <small class="text-muted">Điểm: </small>
                            <span class="badge bg-primary">4.7/5</span>
                        </div>
                        <div class="bg-light p-3 rounded">
                            <p class="mb-0 small">Nghiên cứu có đóng góp quan trọng trong lĩnh vực...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Recommendation -->
            <div class="card shadow-sm border-0 mb-4 border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-robot me-2"></i>Gợi ý từ hệ thống</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-check-circle fa-2x text-success me-3"></i>
                        <div>
                            <h5 class="text-success mb-1">Khuyến nghị: Chấp nhận</h5>
                            <p class="text-muted mb-0">
                                Dựa trên điểm trung bình 4.5/5 và cả 2 phản biện đều khuyến nghị chấp nhận
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Final Decision Form -->
            <div class="card shadow-sm border-0">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-gavel me-2"></i>Ra quyết định cuối cùng</h5>
                </div>
                <div class="card-body">
                    <form id="decisionForm" asp-action="MakeFinalDecision" method="post">
                        <input type="hidden" name="id" value="@submissionId" />

                        <div class="mb-4">
                            <label class="form-label fw-semibold">Quyết định <span class="text-danger">*</span></label>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-success btn-lg w-100" onclick="setDecision('Accept')">
                                        <i class="fas fa-check me-2"></i>Chấp nhận
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-warning btn-lg w-100" onclick="setDecision('Minor')">
                                        <i class="fas fa-edit me-2"></i>Chỉnh sửa nhỏ
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-warning btn-lg w-100" onclick="setDecision('Major')">
                                        <i class="fas fa-edit me-2"></i>Chỉnh sửa lớn
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-danger btn-lg w-100" onclick="setDecision('Reject')">
                                        <i class="fas fa-times me-2"></i>Từ chối
                                    </button>
                                </div>
                            </div>
                            <input type="hidden" name="decision" id="decisionInput" required />
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-semibold">Ghi chú (tùy chọn)</label>
                            <textarea name="comments" class="form-control" rows="4" 
                                      placeholder="Nhập ghi chú bổ sung (nếu có)"></textarea>
                        </div>

                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Sau khi ra quyết định, hệ thống sẽ tự động gửi email thông báo kết quả và các bình luận (ẩn danh) cho tác giả.
                        </div>

                        <div class="d-flex justify-content-end">
                            <a href="/Admin/Submissions" class="btn btn-outline-secondary me-2">
                                <i class="fas fa-times me-2"></i>Hủy
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg" id="btnSubmit" disabled>
                                <i class="fas fa-paper-plane me-2"></i>Xác nhận quyết định
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function setDecision(decision) {
            document.getElementById('decisionInput').value = decision;
            document.getElementById('btnSubmit').disabled = false;
            
            // Update button styles
            document.querySelectorAll('.btn-lg').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
    </script>

    <style>
        .btn-lg.active {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
    </style>
}
