@{
    ViewData["Title"] = "Review Abstract";
    var submissionId = ViewData["SubmissionId"] ?? 0;
}

<div class="container-fluid my-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header -->
            <div class="mb-4">
                <h2 class="text-gradient mb-2">
                    <i class="fas fa-check-circle me-2"></i>Duyệt tóm tắt
                </h2>
                <p class="text-muted">Đọc tóm tắt và ra quyết định chấp nhận hoặc từ chối</p>
            </div>

            <!-- Submission Info -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Thông tin bài báo</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-muted">Tiêu đề</label>
                        <h5 class="mb-0">Nghiên cứu về ứng dụng AI trong quản lý tài chính</h5>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold text-muted">Tóm tắt (Abstract)</label>
                        <div class="bg-light p-4 rounded" style="max-height: 400px; overflow-y: auto;">
                            <p>Đây là tóm tắt bài báo về nghiên cứu ứng dụng AI trong quản lý tài chính. Nghiên cứu này tập trung vào việc phân tích các phương pháp và công nghệ AI hiện đại được áp dụng trong lĩnh vực tài chính. Chúng tôi đã tiến hành nghiên cứu định lượng với dữ liệu từ 50 doanh nghiệp trong 2 năm. Kết quả cho thấy việc áp dụng AI giúp cải thiện hiệu quả quản lý tài chính đáng kể...</p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold text-muted">Chủ đề</label>
                            <p class="mb-0"><span class="badge bg-info">Tài chính & Kế toán</span></p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold text-muted">Từ khóa</label>
                            <div>
                                <span class="badge bg-primary me-1">AI</span>
                                <span class="badge bg-primary me-1">Machine Learning</span>
                                <span class="badge bg-primary me-1">Tài chính</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decision Form -->
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-gavel me-2"></i>Ra quyết định</h5>
                </div>
                <div class="card-body">
                    <form id="reviewForm">
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <button type="button" class="btn btn-success btn-lg w-100" onclick="approveAbstract()">
                                    <i class="fas fa-check-circle me-2"></i>Chấp nhận
                                </button>
                                <small class="form-text text-muted d-block mt-2 text-center">
                                    Bài sẽ chuyển sang trạng thái "Đã duyệt tóm tắt" và mở luồng nộp bài đầy đủ
                                </small>
                            </div>
                            <div class="col-md-6">
                                <button type="button" class="btn btn-danger btn-lg w-100" onclick="showRejectForm()">
                                    <i class="fas fa-times-circle me-2"></i>Từ chối
                                </button>
                                <small class="form-text text-muted d-block mt-2 text-center">
                                    Bài sẽ bị từ chối và gửi email thông báo cho tác giả
                                </small>
                            </div>
                        </div>

                        <!-- Reject Reason (hidden by default) -->
                        <div id="rejectForm" style="display: none;">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Lưu ý:</strong> Bạn phải nhập lý do từ chối (bắt buộc)
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Lý do từ chối <span class="text-danger">*</span></label>
                                <textarea id="rejectReason" class="form-control" rows="5" 
                                          placeholder="Nhập lý do từ chối chi tiết..." required></textarea>
                            </div>
                            <div class="d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-outline-secondary" onclick="hideRejectForm()">
                                    Hủy
                                </button>
                                <button type="button" class="btn btn-danger" onclick="rejectAbstract()">
                                    <i class="fas fa-times me-2"></i>Xác nhận từ chối
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function approveAbstract() {
            if (confirm('Bạn có chắc chắn muốn chấp nhận tóm tắt này không?')) {
                // TODO: Submit to server
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/Admin/ApproveAbstract/@submissionId';
                form.innerHTML = '@Html.AntiForgeryToken()';
                document.body.appendChild(form);
                form.submit();
            }
        }

        function showRejectForm() {
            document.getElementById('rejectForm').style.display = 'block';
        }

        function hideRejectForm() {
            document.getElementById('rejectForm').style.display = 'none';
            document.getElementById('rejectReason').value = '';
        }

        function rejectAbstract() {
            const reason = document.getElementById('rejectReason').value.trim();
            if (!reason) {
                alert('Vui lòng nhập lý do từ chối');
                return;
            }

            if (confirm('Bạn có chắc chắn muốn từ chối tóm tắt này không?')) {
                // TODO: Submit to server
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/Admin/RejectAbstract/@submissionId';
                form.innerHTML = '@Html.AntiForgeryToken()' +
                    '<input type="hidden" name="reason" value="' + reason + '">';
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
}
